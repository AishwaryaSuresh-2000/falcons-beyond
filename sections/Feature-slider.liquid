<script src="https://unpkg.com/flickity@2/dist/flickity.pkgd.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/flickity@2/dist/flickity.min.css">

{% assign collection_main = collections[section.settings.collection_main] %}
{% assign collection_limit = section.settings.collection_limit %}

{% assign cell_align = section.settings.cell_align %}
{% assign wrap_around = section.settings.wrap_around %}
{% assign img_width = section.settings.img_width | append: 'x' %}

<div class="flickity-section-{{ section.id }} flickity-index-slider collection" style="background-color: {{ section.settings.bg }}">
  <div class="page-width">
    <div>
      <p class="text-title text-center" style="margin-bottom:{{ section.settings.title_mb }}px">{{ section.settings.title }}</p>
    </div>
    <div class="flickity-section__carousel carousel-{{section.id }} text-center"
      data-flickity='{
        "cellAlign": "{{ cell_align }}",
        "pageDots": false,
        "freeScroll": true,
        "contain": true,
        "wrapAround": {{ wrap_around }}
      }'>
      
      {% for product in collection_main.products limit: collection_limit %}
        {%- if product.metafields.inventory.ShappifyHidden == 'true' -%}{%- continue -%}{%- endif -%}
        {% assign first_variant = product.selected_or_first_available_variant %}
        {% assign featured_img_src = first_variant.featured_img.src | default: product.featured_image.src %}
        {% assign price = first_variant.price %}
        {% assign compare_at_price = first_variant.compare_at_price %}
        <div class="carousel__cell" style="width:{{ section.settings.cell_width }};margin-right:{{ section.settings.mr }}px">
          <a href="{{ product.url }}">
            <img src="{{ featured_img_src | img_url: img_width }}" alt="{{ product.featured_img.alt }}" />
          </a>
          <a href="{{ product.url }}">
            <h5>{{ product.title }}</h5>
          </a>
          {% if compare_at_price > price %}
            <s class="product__compare-at-price">{{ compare_at_price | money }}</s>
            <p class="product__product-price">{{ price | money }}</p>
          {% else %}
            <p class="product__product-price">{{ price | money }}</p>
          {% endif %}
          <div class="quick-view-button">
            <button
              class="quick-view-trigger"
              data-product-image="{{ featured_img_src | img_url: img_width }}"
              data-product-price="{{ price | money }}"
            >
              Quick View
            </button>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</div>

<div id="quickViewModal" class="modal">
  <div class="modal-content">
    <span class="modal-close">&times;</span>
    <img id="quickViewProductImage" src="" alt="Product Image" />
    <p id="quickViewProductPrice"></p>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const quickViewButtons = document.querySelectorAll(".quick-view-trigger");
  const modal = document.getElementById("quickViewModal");
  const modalImage = document.getElementById("quickViewProductImage");
  const modalPrice = document.getElementById("quickViewProductPrice");

  quickViewButtons.forEach((button) => {
    button.addEventListener("click", function () {
      const productImage = button.getAttribute("data-product-image");
      const productPrice = button.getAttribute("data-product-price");

      modalImage.src = productImage;
      modalPrice.textContent = productPrice;

      modal.style.display = "block";
    });
  });

  const modalClose = document.querySelector(".modal-close");
  modalClose.addEventListener("click", function () {
    modal.style.display = "none";
  });

  window.addEventListener("click", function (event) {
    if (event.target === modal) {
      modal.style.display = "none";
    }
  });
});
</script>

<style>
  /* Your existing styles */

  /* Modal styles */
  .modal {
    display: none; /* Initially hide the modal */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1000;
  }

  .modal-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    padding: 20px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  .modal-close {
    position: absolute;
    top: 10px;
    right: 10px;
    cursor: pointer;
  }
</style>
